 @model Arasan.Models.StockIn

@{
    Layout = "_PopupLayout";
    ViewData["Title"] = "Issue To Indent";
}
<div class="row wrapper border-bottom page-heading">
    <div class="col-lg-12">

        <ol class="breadcrumb">
            <li> <a href="#">Home</a> </li>
            <li> <a>Transaction</a> </li>
            <li class="active"> <strong>Issue To Indent</strong> </li>
        </ol>
    </div>
</div>

<div class="wrapper-content ">
    <div class="row">




        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="widgets-container">
                  @using (Html.BeginForm("IssueToIndent", "StockIn", FormMethod.Post))
                    {
                        @Html.AntiForgeryToken()
                    <form>


                        <div class="row">
                              <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="inputName3" class="col-sm-4 control-label">Item Name<label class="mandatory"></label></label>
                                              
													  <div class="col-sm-8">
                                                    @Html.DisplayFor(C => C.Item)<br/>
                                                    @Html.HiddenFor(C => C.ItemID)
                                                     @Html.HiddenFor(C => C.Location)
                                                      @Html.HiddenFor(C => C.Branch)
                                                </div>
                                            </div>
                                        </div> 
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="inputName3" class="col-sm-4 control-label">Quantity<label class="mandatory"></label></label>
													  <div class="col-sm-8">
                                                    @Html.DisplayFor(C => C.Qty)<br/>
                                                    @Html.HiddenFor(C => C.QtyS,new { @id = "hidStkQty"})
                                                </div>
												
                                            </div>
                                        </div>
                        
                        </div>
                        <div class="row">
                              <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="inputName3" class="col-sm-4 control-label">Location<label class="mandatory"></label></label>
                                              
													  <div class="col-sm-8">
                                            @Html.DisplayFor(C => C.Locationname)<br />
                                                  
                                                </div>
                                            </div>
                                        </div> 
                                        </div> 
<div style="height:30px;"></div>

<div class="row">
          <div class="col-lg-12">
            <div class="ibox float-e-margins">
              
              <div class="ibox-content collapse in">
                <div class="widgets-container">
                  <div >
                    <table id="example7" class="display nowrap table  responsive nowrap table-bordered">
                      <thead>
                        <tr>
                            <th></th>
                          <th>Location Name</th>
                          <th>Indent No.</th>
                          <th>Indent Date</th>
                          <th>Item Name</th>
                          <th>Qty.</th>
                           <th>Unit</th>
                            <th>Stock Qty.</th>
                        </tr>
                      </thead>
                   
                      <tbody>
                            @{
                                                            int i = 0;

                                                            foreach (var item in Model.Indentlist.ToList())
                                                            {
                                                                

                                                                                            <tr id="trBooks@(i)" class="chkitemlst" style="height: 30px;border-bottom: 1px dashed #ddd;">
                                                                                                                              <td>@Html.CheckBoxFor(o => o.Indentlist[i].select, new { @id = "select" + i ,@onclick = "checkfunc("+ i +")"}) </td>
                                                                                                                                        <td>@Html.DisplayFor(o => o.Indentlist[i].LocationName)</td>
                                                                                                                                        <td>@Html.DisplayFor(o => o.Indentlist[i].IndentNo)</td>
                                                                                                                                        <td>@Html.DisplayFor(o => o.Indentlist[i].IndentDate)</td>
                                                                                                                                        <td>@Html.DisplayFor(o => o.Indentlist[i].ItemName)
                                                                                                                                        @Html.HiddenFor(o => o.Indentlist[i].ItemId)
                                                                                                                                         @Html.HiddenFor(o => o.Indentlist[i].LocationID)
                                                                                                                                         @Html.HiddenFor(o => o.Indentlist[i].IndentID)
                                                                                                                                        </td>
                                                                                                                                        <td>@Html.DisplayFor(o => o.Indentlist[i].Quantity)
                                                                                                                                        @Html.HiddenFor(o => o.Indentlist[i].qty, new { @id = "hidQty" + i })
                                                                                                                                        </td>
                                                                                                                                         <td>@Html.DisplayFor(o => o.Indentlist[i].Unit)</td>
                                                                                                                                       <td> @Html.TextBoxFor(o => o.Indentlist[i].StockQty, new { @id = "txtQty" + i, @class = "form-control", onkeydown = "return isNumeric2(event.keyCode,this.value)", style = "width: 100px;text-align:right", @onkeyup = "changeQty(this," + i + ")" }) </td>
                                                                                                                               
                                                                                                                                    
                                                                                             </tr>

                                                                i++;
                                                            }
                                                        }
                     
                        
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
    
                    <div style="height:30px;"></div>

                         <div class="row">
                             <div class="col-md-5"></div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                            
                                                <label for="inputName3" class="col-sm-4 control-label">Total Quantity<label class="Mandatory"></label></label>
                                                <div class="col-sm-8">
                                                    @Html.TextBoxFor(C => C.TotalQty, new { @id = "txttotalQty", @Class = "form-control", @TabIndex = 1 ,@readonly=true})
                                                </div>
                                            </div>
                                        </div>
                                        </div>      

                                           <div style="height:30px;"></div>
                        <div class="row">
                <div class="col-sm-4 col-sm-offset-2">

                        <button type="submit" class="btn aqua m-t-xs bottom15-xs" id="btnSave">Submit</button>
                        <button class="btn btn-danger" type="button" causesvalidation="false" onclick="location.href='@Url.Action("ListStockIn", "StockIn")'">Cancel</button>
                        </div>
                        </div>
                                 
                    </form>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

                          <script>
                           
                            
         $('.form_date').datetimepicker({
     //   language:  'fr',
        weekStart: 1,
        todayBtn:  1,
    autoclose: 1,
    todayHighlight: 1,
    startView: 2,
    minView: 2,
    forceParse: 0
    });
    //function checkfunc(i) {
    //    var j = 0;
    //    var tot = 0;
    //    var totqty = 0;
    //    $('tr.chkitemlst' + i).each(function () {
    //        if ($(this).css('display') !== 'none') {
    //            if ($('#select' + i ).prop('checked') == true) {
    //                var qty = document.getElementById('txtQty' + i).value;
    //                alert(qty);
    //                totqty += eval(qty);
    //                tot += 1;
    //            }
    //        }
           
    //    });
    //    document.getElementById("txttotalQty").value = totqty.toFixed(2);
    //    //document.getElementById("totalqty").innerHTML = totqty;
    //}
    function changeQty(_this, i) {
                try {
                    ////////
                    var lqty = document.getElementById("hidQty" + i).value;
                    var lstkqty=document.getElementById("txtQty" + i).value;
                    if (eval(lstkqty)  > eval(lqty)) {
                        document.getElementById("txtQty" + i).value = "";
                        alert("Stock Quantity Exceeds the Actual Quantity");
                    }
                    /////////
                       var j = 0;
                    var qty = 0;
                    var tot = 0;
                    $('tr.chkitemlst').each(function () {
                        if ($(this).css('display') !== 'none') {
                            qty = $(this).find('#txtQty' + j.toString()).val();
                            if (qty == "")
                        qty = 0;

                         tot += eval(qty);
                              }
                        j += 1;
                    });
                  document.getElementById("txttotalQty").value = tot.toFixed(2);
                    const stkqty = document.getElementById("hidStkQty").value;
                    const totqty=tot.toFixed(2);
                    const cmpqty = eval(totqty) - 1;
                    if (eval(cmpqty)  < eval(stkqty)) {
                        
                    } else {
                          //isValid = false;
                        //alert(stkqty);
                        //alert(cmpqty);
                        alert("Total Quantity Exceeds the Stock Quantity");
                        return false;
                        }
                   
                        
                    
                }
                catch (ex) {
                    alert(ex.message);
                }
            }

              $(document).ready(function () {
                $('#btnSave').click(function (e) {
                    var isValid = true;
                    const stkqty = document.getElementById("hidStkQty").value;
                    const totqty=document.getElementById("txttotalQty").value;
                      const cmpqty = eval(totqty) - 1;
                       if (eval(cmpqty)  < eval(stkqty)) {
                        
                    } 
                    else {
                        isValid = false;
                        alert("Total Quantity Exceeds the Stock Quantity");
                        return false;
                    }
                   

                     if (isValid == false)
                        e.preventDefault();

                });

            });

                          </script>

                     