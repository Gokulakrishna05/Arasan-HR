@model Arasan.Models.WorkOrder

@{
    ViewData["Title"] = "Work Order";
}
<style>

    .mandatory {
        color: red;
        position: relative;
        top: 2px;
        left: 5px;
    }
</style>
<div class="row wrapper border-bottom page-heading">
    <div class="col-lg-12">

        <ol class="breadcrumb">
            <li> <a href="#">Home</a> </li>
            <li> <a>Sales</a> </li>
            <li class="active"> <strong> Work Order</strong> </li>
        </ol>
    </div>
</div>
<div class="wrapper-content ">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="widgets-container">
                    <h5 style="font-size:14px">Work Order</h5>
                    <hr>
                    @using (Html.BeginForm("WorkOrder", "WorkOrder", FormMethod.Post))
                        {
                          @Html.AntiForgeryToken()
                    <form>
                        <div class="row">
                          @*  <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Branch<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                        @Html.DropDownListFor(C => C.Branch, Model.Brlst, new { @id = "ddlBranch", @Class = "form-control chosen-select", @TabIndex = 1 })
                                       
                                    </div>
                                </div>
                            </div>*@
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="inputName3" class="col-sm-4 control-label">Location<label class="mandatory">*</label></label>
                                    <div class="col-sm-8">
                                        @Html.DropDownListFor(C => C.Location, Model.Loc,"---Please Select---" ,new { @id = "ddlLocation", @Class = "form-control _select", @TabIndex = 1,@onchange="changeStockItem(this.value)" })
                                            @Html.HiddenFor(C => C.ID)
                                        @Html.HiddenFor(C => C.Branch)
                                       <br />
                                    </div>
                                </div>
                            </div>
                                
                       </div>
                            <div class="row">
                               
                                <div class="col-md-6">
                                    <div class="form-group">

                                         <br /> <label for="inputName3" class="col-sm-4 control-label">Customer Name<label class="mandatory">*</label></label>
                                        <div class="col-sm-8">
                                        @Html.DropDownListFor(C => C.Customer, Model.partylst,"---Please Select---" ,new { @id = "ddlCustomer", @Class = "form-control _select", @TabIndex = 1 })
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">

                                        <label for="inputName3" class="col-sm-4 control-label">Order or Sample?<label class="Mandatory"></label></label>
                                        <div class="col-sm-8">
                                            <div class="input-group">

                                                @Html.RadioButtonFor(C => C.OrderType, "ORDER", new { @TabIndex = 2 , Checked="true",value="ORDER"})
                                                <label id="mt-radio">ORDER</label>
                                                @Html.RadioButtonFor(C => C.OrderType, "SAMPLE", new { @TabIndex = 3 })
                                                <label id="mt-radio">SAMPLE</label>


                                            </div><br />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Jop Id<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                            @Html.TextBoxFor(C => C.JopId, new { @id = "txtJopId", @class = "form-control", @TabIndex = 1,@readonly="readonly" })<br />

                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="inputName3" class="col-sm-4 control-label">Job Date<label class="mandatory">*</label></label>
                                    <div class="input-group date form_date col-sm-8" data-date="" data-date-format="dd-M-yyyy">
                                        @Html.TextBoxFor(C => C.JopDate, new { @id = "JopDate", @class = "form-control", @TabIndex = 2,@size="32",@readonly=true })
                                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span> <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                                    </div>

                                    <br />

                                </div>
                            </div>
                        </div>
                      
                      

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Customer PO. NO.<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                        @Html.TextBoxFor(C => C.CusNo, new { @id = "txtCusNo", @class = "form-control", @TabIndex = 1 })<br />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="inputName3" class="col-sm-4 control-label">Customer PO. Date<label class="Mandatory"></label></label>
                                    <div class="input-group date form_date col-sm-8" data-date="" data-date-format="dd-M-yyyy">
                                        @Html.TextBoxFor(C => C.Cusdate, new { @id = "Cusdate", @class = "form-control", @TabIndex = 2,@size="32",@readonly=true })
                                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span> <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                                    </div>

                                    <br />


                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Currency<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                         @Html.DropDownListFor(C => C.Currency, Model.Curlst, new { @id = "ddlCurrency", @Class = "form-control _select", @TabIndex = 1 }) 
                                        <br />


                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="inputName3" class="col-sm-4 control-label">Exchange Rate<label class="Mandatory"></label></label>

                                    <div class="col-sm-8">
                                        @Html.TextBoxFor(C => C.ExRate, new { @id = "txtExRate", @class = "form-control", @TabIndex = 1,onkeydown = "return isNumeric2(event.keyCode,this.value)" })<br />
                                    </div>

                                </div>
                            </div>
                        </div>
                      

                        @*<div class="row">
                              <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Rate Type<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                        @Html.TextBoxFor(C => C.RateType, new { @id = "txtRateType", @class = "form-control", @TabIndex = 1 })<br />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Terms and Cond ID<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="inputEmail3" placeholder="" type="text">
                                    </div>
                                </div>
                            </div>
                             
                        </div>*@

                        
 
                      @*  <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Sales Limit<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                        @Html.TextBoxFor(C => C.SalesLimit, new { @id = "txtSalesLimit", @class = "form-control", @TabIndex = 1 })<br />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Sales Value<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                        @Html.TextBoxFor(C => C.SalesValue, new { @id = "txtSalesValue", @class = "form-control", @TabIndex = 1 })<br />
                                    </div>
                                </div>
                            </div>
                        </div>*@
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Transaction Amout<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                            @Html.TextBoxFor(C => C.TransAmount, new { @id = "txtTransAmount", @class = "form-control", @TabIndex = 1,placeholder="0",onkeydown = "return isNumeric2(event.keyCode,this.value)" })<br />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Credit Limit<label class="Mandatory"></label></label>
                                    <div class="col-sm-8">
                                        @Html.TextBoxFor(C => C.CreditLimit, new { @id = "txtCreditLimit", @class = "form-control", @TabIndex = 1,onkeydown = "return isNumeric2(event.keyCode,this.value)" })<br />
                                    </div>
                                </div>
                            </div>
                        </div>

                        
                        <div style="height:30px;"></div>
                        <div class="row">


                            <br />   <br />  <div class="col-lg-12" style=" overflow-y:scroll; min-width:800px; min-height:400px;">

                                <br />   <br />
                                <div class="scroll">
                                    <table class="table table-striped table-hover" id="dataTable">
                                                    <thead>
                                                        <tr>
                                                          
                                                            <th>Item Id </th>
                                                            <th>Item Spec</th>
                                                            <th> Unit </th>
                                                            <th> Order Qty </th>
                                                           @* <th> Dispatch Qty </th>*@
                                                            <th> Old Rate </th>
                                                            <th> Rate </th>

                                                            <th> Amount </th>
                                                    <th> Discount </th>
                                                           <th> Qty Disc </th>
                                                           @*  <th>Cash Disc </th>
                                                            <th> Spel Disc </th>
                                                            <th> Introd Disc </th>
                                                            <th> Trade Disc </th>
                                                            <th> Addition Disc </th>
                                                            *@

                                              @*  <th>  Freight </th>
                                                            <th> Freight Amount </th>*@
                                                            <th> Tax Type </th>
                                                            <th> CGSTP </th>
                                                            <th> SGSTP </th>
                                                            <th> IGSTP </th>
                                                            <th>CGST </th>
                                                            <th>SGST </th>
                                                            <th>IGST </th>
                                                                  <th>Total Amount </th>
                                                            <th> Packing Spec </th>
                                                             
                                                        </tr>
                                                    </thead>
                                        <tbody id="tbBooks">

                                                @{

                                                    int i = 0;
                                                    int j = 1;
                                                    foreach (var item in Model.Worklst.ToList())
                                                    {
                                                                            <tr id="trBook@(i)" class="chkitemlst" style="height: 30px;border-bottom: 1px dashed #ddd;">
                                                                              
                                                                                <td>
                                                                                @Html.DropDownListFor(o => o.Worklst[i].itemid, Model.Worklst[i].itemlst, "Please Select", new { @class = "form-control _select newcss", @id = "ddlItem" + i, style = "width: 200px;", onchange = "changeItemDetail(this.value," + i + ")" })
                                                                                    @Html.HiddenFor(o => o.Worklst[i].itemid)
                                                                                </td>
                                                                                <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].itemspec,  new { @id = "txtitemspec" + i, @class = "form-control", style = "width: 80px;"})
                                                                                </td>
                                                                                <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].unit, new { @id = "txtunit" + i, @class = "form-control", style = "width: 80px;" ,onkeydown = "return isNumeric2(event.keyCode,this.value)", @readonly = "readonly"})
                                                                                </td>
                                                                              
                                                                                <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].orderqty, new { @id = "txtorderqty" + i, @class = "form-control",onkeydown = "return isNumeric2(event.keyCode,this.value)", @onkeyup = "changeQty(this," + i + ")", style = "width: 80px;" })
                                                                                </td>
                                                                                @*<td>
                                                                @Html.TextBoxFor(o => o.Worklst[i].disqty, new { @id = "txtdisqty" + i, @class = "form-control", style = "width:220px;",onkeydown = "return isNumeric2(event.keyCode,this.value)"})
                                                            </td>*@
                                                            <td><label id="oldrate@(i)"></label></td>
                                                                                <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].rate, new { @id = "txtRate" + i, @class = "form-control",onkeydown = "return isNumeric2(event.keyCode,this.value)", @onkeyup = "changeQty(this," + i + ")", style = "width: 80px;" ,@readonly = "readonly"})
                                                                                </td>
                                                                                <td>
                                                                                    @Html.HiddenFor(o => o.Worklst[i].Isvalid, new { @id = "Isvalid" + i })
                                                                                    @Html.TextBoxFor(o => o.Worklst[i]. amount, new { @id = "txtamount" + i , @class = "form-control",onkeydown = "return isNumeric2(event.keyCode,this.value)", style = "width: 80px;" ,@readonly = "readonly" })
                                                                                </td>
                                                                                 <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].discount, new { @id = "txtdiscount" + i, @class = "form-control", style = "width: 80px;" ,onkeydown = "return isNumeric2(event.keyCode,this.value)", @onkeyup = "changeQty(this," + i + ")"})
                                                                                </td>
                                                                         <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].qtydis, new { @id = "txtqtydis" + i, @class = "form-control", style = "width: 80px;" ,onkeydown = "return isNumeric2(event.keyCode,this.value)", @onkeyup = "changeQty(this," + i + ")"})
                                                                                </td>
                                                                                 @* <td>
                                                                        @Html.TextBoxFor(o => o.Worklst[i].cashdis, new { @id = "txtcashdis" + i, @class = "form-control",onkeydown = "return isNumeric2(event.keyCode,this.value)", style = "width: 80px;", @onkeyup = "changeQty(this," + i + ")" })
                                                                    </td>
                                                                          <td>
                                                                    @Html.TextBoxFor(o => o.Worklst[i].spldis, new { @id = "txtspldis" + i, @class = "form-control",onkeydown = "return isNumeric2(event.keyCode,this.value)", style = "width: 80px;", @onkeyup = "changeQty(this," + i + ")" })
                                                                </td>
                                                               

                                                                <td>
                                                                    @Html.TextBoxFor(o => o.Worklst[i].introdis, new { @id = "txtintrodis" + i, @class = "form-control", style = "width: 80px;",onkeydown = "return isNumeric2(event.keyCode,this.value)", @onkeyup = "changeQty(this," + i + ")"})
                                                                </td>
                                                                <td>
                                                                    @Html.TextBoxFor(o => o.Worklst[i].tradedis, new { @id = "txttradedis" + i, @class = "form-control", style = "width: 80px;" ,onkeydown = "return isNumeric2(event.keyCode,this.value)", @onkeyup = "changeQty(this," + i + ")"})
                                                                </td>
                                                                <td>
                                                                    @Html.TextBoxFor(o => o.Worklst[i].additiondis, new { @id = "txtadditiondis" + i, @class = "form-control", style = "width: 80px;" ,onkeydown = "return isNumeric2(event.keyCode,this.value)", @onkeyup = "changeQty(this," + i + ")"})
                                                                </td>*@
                                                                                <td>
                                                                                    @Html.DropDownListFor(o => o.Worklst[i].tax,Model.Worklst[i].taxlst, new { @id = "txttax" + i, @class = "form-control _select", style = "width: 130px;" ,onkeydown = "return isNumeric2(event.keyCode,this.value)", @readonly = "readonly", @onkeyup = "changeQty(this," + i + ")"})
                                                                                </td>
                                                                                  <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].cstp, new { @id = "txtcgstp" + i, @class = "form-control", style = "width: 80px;", @onkeyup = "changeQty(this," + i + ")"})
                                                                                </td>
                                                                                 <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].sgstp, new { @id = "txtsgstp" + i, @class = "form-control", style = "width: 80px;", @onkeyup = "changeQty(this," + i + ")"})
                                                                                </td>
                                                                                 <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].igstp, new { @id = "txtigstp" + i, @class = "form-control", style = "width: 80px;", @onkeyup = "changeQty(this," + i + ")"})
                                                                                </td>
                                                                                 <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].cgst, new { @id = "txtcgst" + i, @class = "form-control", style = "width: 80px;"})
                                                                                </td>
                                                                                 <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].sgst, new { @id = "txtsgst" + i, @class = "form-control", style = "width: 80px;"})
                                                                                </td>
                                                                                 <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].igst, new { @id = "txtigst" + i, @class = "form-control", style = "width: 80px;"})
                                                                                </td>
                                                                                <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].Totamt, new { @id = "txtTotamt" + i, @class = "form-control", style = "width: 80px;"})
                                                                                </td>
                                                                                <td>
                                                                                    @Html.TextBoxFor(o => o.Worklst[i].packind, new { @id = "txtpackind" + i, @class = "form-control", style = "width: 80px;"})
                                                                                </td>
                                                                               



                                                                                <td>
                                                                                    @Html.HiddenFor(o => o.Worklst[i].Isvalid, new { @id = "Isvalid" + i })
                                                                                    <img onclick="removeRow(@(i));" src="../Images/delete.png" style="cursor:pointer" /> <input name="Suplst.Index" type="hidden" value="@(i)" />
                                                                                </td>

                                                                            </tr>

                                                        i = i + 1;
                                                        j = j + 1;
                                                    }
                                                }


                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                            </div>


                             <div class="row">
                                <div class="col-md-4" style="overflow-x:scroll; min-width:300px; min-height:300px;">

                                    @* <div class="ibox float-e-margins">*@

                                    <!-- / ibox-title -->
                                    @* <div id="demo3" class="ibox-content collapse in">
                                <div class="borderedTable">
                                <div class="table-scrollable">*@
                                    <table class="table table-striped table-hover" id="dataTable">
                                        <thead>
                                           
                                        </thead>
                                        <tbody id="tbBooks">
                                            @{



                                                                    <tr>

                                                                        <th>GROSS</th>
                                                                        <td>
                                                                            @Html.TextBoxFor(o => o.Gross, new { @id = "txtGross"  , @class = "form-control", style = "width: 150px;text-align:right", @readonly = "readonly"})
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>DISCOUNT</th>
                                                                        <td>
                                                                            @Html.TextBoxFor(o => o. Discount, new { @id = "txtDiscount"  , @class = "form-control", style = "width: 150px;text-align:right" , @readonly = "readonly"})
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>Fright</th>
                                                                        <td>

                                                                            @Html.TextBoxFor(o => o. FrightCharge, new { @id = "txtFrightCharge"  , @class = "form-control", onkeydown = "return isNumeric2(event.keyCode,this.value)", style = "width: 150px;text-align:right",@onkeyup = "changeQty(this)"})
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>CGST <label id="CGSTDISP"></label> %</th>
                                                                        <td>

                                                                            @Html.TextBoxFor(o => o. cgst, new { @id = "txtcgst"  , @class = "form-control", onkeydown = "return isNumeric2(event.keyCode,this.value)", style = "width: 150px;text-align:right",@readonly="readonly"})
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>SGST <label id="SGSTDISP"></label> %</th>
                                                                        <td>
                                                                            @Html.TextBoxFor(o => o. sgst, new { @id = "txtsgst"  , @class = "form-control", style = "width: 150px;text-align:right", @readonly = "readonly" })
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th>IGST <label id="IGSTDISP"></label> %</th>
                                                                        <td>
                                                                            @Html.TextBoxFor(o => o. igst, new { @id = "txtigst"  , @class = "form-control", style = "width: 150px;text-align:right", @readonly = "readonly" })
                                                                        </td>
                                                                    </tr>
                                                
                                                                    <tr>
                                                                        <th> ROUND OFF</th>
                                                                        <td>
                                                                            @Html.TextBoxFor(o => o. Round, new { @id = "txtRound"  , @class = "form-control", onkeydown = "return isNumeric2(event.keyCode,this.value)", style = "width: 150px;text-align:right" ,@readonly="readonly" })
                                                                        </td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th> TOTAL </th>
                                                                        <td>

                                                                            @Html.TextBoxFor(o => o. Net, new { @id = "txtNet"  , @class = "form-control", onkeydown = "return isNumeric2(event.keyCode,this.value)", style = "width: 150px;text-align:right",@readonly="readonly"})
                                                                        </td>


                                                                    </tr>

                                            }


                                        </tbody>
                                    </table>
                                </div>


                        <div style="height:30px;"></div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">

                                            <br />   <br />  <label for="inputName3" class="col-sm-2 control-label">Narration<label class="Mandatory"></label></label>
                                    <div class="col-sm-10">
                                        <textarea class="form-control" id="inputEmail3" type="text" rows="3"></textarea>
                                    </div>
                                </div>
                            </div>

                        </div>
                                <div style="height:30px;"></div>
                                <button type="submit" class="btn aqua m-t-xs bottom15-xs" id="btnSave">Submit</button>
                                <button class="btn btn-danger" type="button" causesvalidation="false" onclick="location.href='@Url.Action("ListWorkOrder", "WorkOrder")'">Cancel</button>
                    </form>
                    }
                </div>
            </div>
        </div>

    </div>
</div>
<script>
    $(function () {
        $('._select').select2();
    });
   @* $(function () {
        var jobid = '@ViewBag.Quo';
        changeQuoDet('edit', jobid);
    });*@
    $('.form_date').datetimepicker({
        //   language:  'fr',
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0
    });
     function changeQty(_this, i) {
                try {

                       var j = 0;
                    var qty = 0;
                    var tot = 0;
                    var totamt = 0;
                    var totdis = 0;
                    var totalamount = 0;
                     var totcgst = 0;
                var totsgst = 0;
                var totigst = 0;
                             var iqty= document.getElementById("txtorderqty" + i).value;
                             var rate= document.getElementById("txtRate" + i).value;
                                var qdis= document.getElementById("txtqtydis" + i).value;
                             var IGST = document.getElementById("txtigstp" + i).value;

            var CGST = document.getElementById("txtcgstp" + i).value;
                    alert(CGST);
            var SGST = document.getElementById("txtsgstp" + i).value;
                              if (qdis == "")
                qdis = 0;
                 if (IGST == "")
                IGST = 0;


            if (CGST == "")
                CGST = 0;


            if (SGST == "")
                SGST = 0;

                  
                      
                         var amount=eval(iqty)*eval(rate) ;
                          document.getElementById("txtamount" +i).value = amount.toFixed(2);
                          
                    var igstperc = (eval(amount) / 100) * eval(IGST);
            var cgstperc = (eval(amount) / 100) * eval(CGST);
            var sgstperc = (eval(amount) / 100) * eval(SGST);
           document.getElementById("txtcgst" + i).value = cgstperc.toFixed(2);
            document.getElementById("txtsgst" + i).value = sgstperc.toFixed(2);
            document.getElementById("txtigst" + i).value = igstperc.toFixed(2);
                     var discount = eval(qdis) * eval(iqty);
                   
             
                     document.getElementById("txtdiscount" +i).value = discount ;
            var tottax = eval(amount) + eval(igstperc) + eval(cgstperc) + eval(sgstperc);

             var totdisc = eval(tottax) - eval(discount) ;
                     document.getElementById("txtTotamt" +i).value = totdisc.toFixed(2);
  
                      
                    
                        $('tr.chkitemlst').each(function () {
                if ($(this).css('display') !== 'none') {
                 
                    var amt = $(this).find('#txtamount' + j.toString()).val();
                    if (amt == "")
                        amt = 0;

                    totamt += eval(amt);

                       var dis = $(this).find('#txtdiscount' + j.toString()).val();
                    if (dis == "")
                        dis = 0;

                    totdis += eval(dis);
                     var total = $(this).find('#txtTotamt' + j.toString()).val();
                    if (total == "")
                        total = 0;

                    totalamount += eval(total);

                      var totcgstamt = $(this).find('#txtcgst' + j.toString()).val();
                        if (totcgstamt == "")
                            totcgstamt = 0;

                        totcgst += eval(totcgstamt);

                        var sgstdisc = $(this).find('#txtsgst' + j.toString()).val();
                        if (sgstdisc == "")
                            sgstdisc = 0;

                        totsgst += eval(sgstdisc);

                        var igstdisc = $(this).find('#txtigst' + j.toString()).val();
                        if (igstdisc == "")
                            igstdisc = 0;

                        totigst += eval(igstdisc);
                    
                    
                }
                j += 1;
            });
                   
                   document.getElementById("txtGross").value = totamt.toFixed(2);         
                   document.getElementById("txtDiscount").value = totdis.toFixed(2);         
                   document.getElementById("txtNet").value = totalamount.toFixed(2);         
                   document.getElementById("txtcgst").value = totcgst.toFixed(2);         
                   document.getElementById("txtsgst").value = totsgst.toFixed(2);         
                   document.getElementById("txtigst").value = totigst.toFixed(2);         
                             
                   
                }
                catch (ex) {
                    alert(ex.message);
                }
            }

     function changeStockItem(loc) {
       
        $.ajax({
            url: "GetItemJSON",
            type: "post",
            data: { 'loc': loc },
            cache: false,
            success: function (response) {
                var newlist;
                //alert(JSON.stringify(response));
                newlist = response.Ilst;
                   var i = 0;
                
                        $('tr.chkitemlst').each(function () {
                    if ($(this).css('display') !== 'none') {
                        PopulateDropDown("#ddlItem" + i, response);
                        i += 1;
                    }
                });
                         
                
            },
            error: function () {
                debugger;
                alert("Please Select Location");
            }
        });
    }
    function changeItemDetail(ItemId,i) {
        var loc = document.getElementById("ddlLocation").value;
        var party = document.getElementById("ddlCustomer" ).value;
   $.ajax({
       url: 'GetItemDetail',
      data: { 'ItemId': ItemId ,'loc':loc,'party':party},
       type: "GET",
       success: function (result) {



          document.getElementById("txtunit" + i).value = result.unit;
          document.getElementById("txtitemspec" + i).value = result.desc;

          document.getElementById("txtRate" + i).value = result.rate;
          document.getElementById("oldrate" + i).innerHTML = result.oldrate;

       },
        error: function () {
            alert("Data Not Found");
      }
  });

   $.ajax({
            url: "GetTaxJSON",
            type: "post",
            data: { 'ItemId': ItemId },
            cache: false,
            success: function (response) {
                var newlist;
                //alert(JSON.stringify(response));
                newlist = response.Ilst;
                 
                
                        $('tr.chkitemlst').each(function () {
                    if ($(this).css('display') !== 'none') {
                        PopulateDropDown("#txttax" + i, response);
                        
                    }
                });
                         
                
            },
            error: function () {
                debugger;
                alert("Please Select Location");
            }
        });
    }
    //    document.getElementById("tbBooks").innerHTML = "";
    //    $.ajax({
    //        url: 'GetSalesQuoDetails',
    //        type: "post",
    //        data: { "id": ItemId, 'jobid': jobid },
    //        cache: false,

    //        success: function (list) {
    //            //if (list != null && list.length > 0) {
    //            list.forEach((item) => {

    //                var index = $("#tbBooks").children("tr").length;
    //                //alert(item.batch);
    //                var items = " <td><label>" + item.items + " </label><input type='hidden' value=" + item.itemid + " id='txtitemid" + index + "' name='Worklst[" + index + "].itemid'></td > ";

    //                var itemspec = "<td><input class='form-control' id='txtitemspec" + index + "' name='Worklst[" + index + "].itemspec'  style='width: 60px;' type='text'   value=" + item.itemspec + "   /></td>";

    //                var Unit = "<td><input class='form-control' id='txtunit" + index + "' name='Worklst[" + index + "].unit'  style='width: 150px;' type='text' readonly='True' value=" + item.unit + " /></td>";

    //                var orderqty = "<td><input class='form-control' id='txtorderqty" + index + "' name='Worklst[" + index + "].orderqty'  style='width: 90px;' type='text' readonly='True'  value=" + item.orderqty + " /></td>";

    //                var disqty = "<td><input class='form-control' id='txtdisqty" + index + "' name='Worklst[" + index + "].disqty'  style='width: 90px;' type='text' onkeydown = 'return isNumeric2(event.keyCode,this.value)' value=" + item.disqty + "     /></td>";
      
    //                var rate = "<td><input class='form-control' id='txtrate" + index + "' name='Worklst[" + index + "].rate'  style='width: 100px;' type='text'  readonly='True'  value=" + item.rate + " /></td>";

    //                var amount = "<td><input class='form-control' id='txtamount" + index + "' name='Worklst[" + index + "].amount' placeholder='0'  style='width: 100px;' type='text'  readonly='True'  value=" + item.amount + " /></td>";

    //                var qtydis = "<td><input class='form-control' id='txtqtydis" + index + "' name='Worklst[" + index + "].qtydis'  style='width: 90px;' type='text' onkeydown = 'return isNumeric2(event.keyCode,this.value)' value=" + item.qtydis + "    /></td>";
    //                var spldis = "<td><input class='form-control' id='txtspldis" + index + "' name='Worklst[" + index + "].spldis'  style='width: 90px;' type='text'  onkeydown = 'return isNumeric2(event.keyCode,this.value)'  value=" + item.spldis + "  /></td>";

    //                var cashdis = "<td><input class='form-control' id='txtcashdis" + index + "' name='Worklst[" + index + "].cashdis'  style='width: 90px;' type='text'  onkeydown = 'return isNumeric2(event.keyCode,this.value)'   value=" + item.cashdis + " /></td>";
    //                var introdis = "<td><input class='form-control' id='txtintrodis" + index + "' name='Worklst[" + index + "].introdis'  style='width: 90px;' type='text'     onkeydown = 'return isNumeric2(event.keyCode,this.value)' value=" + item.introdis + " /></td>";

    //                var tradedis = "<td><input class='form-control' id='txttradedis" + index + "' name='Worklst[" + index + "].tradedis'  style='width: 90px;' type='text'    onkeydown = 'return isNumeric2(event.keyCode,this.value)' value=" + item.tradedis + " /></td>";

    //                var additiondis = "<td><input class='form-control' id='txtadditiondis" + index + "' name='Worklst[" + index + "].additiondis'  style='width: 90px;' type='text'   onkeydown = 'return isNumeric2(event.keyCode,this.value)' value=" + item.additiondis + "  /></td>";
    //                var discount = "<td><input class='form-control' id='txtdiscount" + index + "' name='Worklst[" + index + "].discount'  style='width: 90px;' type='text' readonly='True'  value=" + item.discount + " /></td>";

    //                var Freight = "<td><input class='form-control' id='txtFreight" + index + "' name='Worklst[" + index + "].freight'  style='width: 90px;' type='text'   onkeydown = 'return isNumeric2(event.keyCode,this.value)' value=" + item.freight + "  /></td>";
               
    //                var FreightAmt = "<td><input class='form-control' id='txtFreightAmt" + index + "' name='Worklst[" + index + "].freightamt'  style='width: 90px;' type='text' onkeydown = 'return isNumeric2(event.keyCode,this.value)'   value=" + item.freightamt + "  /></td>";

    //                var taxtype = "<td><input class='form-control' id='txttaxtype" + index + "' name='Worklst[" + index + "].taxtype'  style='width: 120px;' type='text'  value=" + item.taxtype + "    /></td>";

    //                var matsupply = "<td><input class='form-control' id='txtmatsupply" + index + "' name='Worklst[" + index + "].matsupply'  style='width: 90px;' type='text'  value=" + item.matsupply + "    /></td>";
    //                var packind = "<td><input class='form-control' id='txtpackind" + index + "' name='Worklst[" + index + "].packind'  style='width: 130px;' type='text'   value=" + item.packind + "   /></td>";

    //                //var tax = "<td><input class='form-control' id='txttax" + index + "' name='Worklst[" + index + "].tax'  style='width: 60px;' type='text'      /></td>";
    //                var removeCell = "<td><input id='Isvalid" + index + "' name='Worklst[" + index + "].Isvalid' type='hidden' value='Y'><img  src='../Images/delete.png' onclick='removeRow(" + index + ");'  style='cursor:pointer' /><input name='Worklst.Index' type='hidden' value='" + index + "'  /></td>";


    //                var newRow = "<tr class='chkitemlst'  style='height: 30px;border-bottom: 1px dashed #ddd;'  id='trBook" + index + "'>" + items + itemspec + Unit + orderqty + disqty + rate + amount + qtydis + spldis + cashdis + introdis + tradedis + additiondis + discount + Freight + FreightAmt + taxtype + matsupply + packind  + removeCell + "</tr>";

    //                $("#tbBooks").append(newRow);
    //            });
    //            //}
    //        },
    //        error: function () {
    //            alert("Data Not Found");
    //        }
    //    });
    //}
     function removeRow(id) {
        var table = document.getElementById("dataTable");
        var rowCount = table.rows.length;
        var row = document.getElementById('trBook' + id);
        var j = 0;
        $('tr.chkitemlst').each(function () {
            if ($(this).css('display') !== 'none') {
                j += 1;
            }
        });
        if (j > 1) {
            row.style.display = "none";
            document.getElementById('Isvalid' + id).value = "N";
        }
        else {
            alert("Cannot delete all the rows.")
        }
        }
    $(document).ready(function () {
        $('#btnSave').click(function (e) {
            var isValid = true;
            if (document.getElementById("ddlLocation").value == "" || document.getElementById("ddlLocation").value == 0) {
                isValid = false;
                $(ddlLocation).css({
                    "border": "1px solid red",
                    "background": "#FFCECE"
                });

                alert("Please Select Location");
                return false;
            }
            else {
                $(ddlLocation).css({
                    "border": "",
                    "background": ""
                });
            }
            if (document.getElementById("txtJopId").value == "") {
                isValid = false;
                $(txtJopId).css({
                    "border": "1px solid red",
                    "background": "#FFCECE"
                });

                alert("Please Enter  Jop Id");
                return false;
            }
            else {
                $(txtJopId).css({
                    "border": "",
                    "background": ""
                });
            }
            if (document.getElementById("JopDate").value == "") {
                isValid = false;
                $(JopDate).css({
                    "border": "1px solid red",
                    "background": "#FFCECE"
                });

                alert("Please Select  Jop Date");
                return false;
            }
            else {
                $(JopDate).css({
                    "border": "",
                    "background": ""
                });
            }
            if (document.getElementById("ddlQuo").value == "" || document.getElementById("ddlQuo").value == 0) {
                isValid = false;
                $(ddlQuo).css({
                    "border": "1px solid red",
                    "background": "#FFCECE"
                });

                alert("Please Select Quotation No");
                return false;
            }
            else {
                $(ddlQuo).css({
                    "border": "",
                    "background": ""
                });
            }

            if (document.getElementById("txtCustomer").value == ""  ) {
                isValid = false;
                $(txtCustomer).css({
                    "border": "1px solid red",
                    "background": "#FFCECE"
                });

                alert("Please Enter Customer Name");
                return false;
            }
            else {
                $(txtCustomer).css({
                    "border": "",
                    "background": ""
                });
            }
            //if (document.getElementById("ddlToloc").value == "" || document.getElementById("ddlToloc").value == 0) {
            //    isValid = false;
            //    $(ddlToloc).css({
            //        "border": "1px solid red",
            //        "background": "#FFCECE"
            //    });

            //    alert("Please Select To Location");
            //    return false;
            //}
            //else {
            //    $(ddlToloc).css({
            //        "border": "",
            //        "background": ""
            //    });
            //}
            //if (document.getElementById("ddltype").value == "" || document.getElementById("ddltype").value == 0) {
            //    isValid = false;
            //    $(ddltype).css({
            //        "border": "1px solid red",
            //        "background": "#FFCECE"
            //    });

            //    alert("Please Select Type");
            //    return false;
            //}
            //else {
            //    $(ddltype).css({
            //        "border": "",
            //        "background": ""
            //    });
            //}
   


                    if (isValid == false)
                e.preventDefault();
        });

    });
    function PopulateDropDown(dropDownId, list) {
        //alert(list);
        $(dropDownId).empty().append('<option selected="selected" value="0">Please select</option>');
        if (list != null && list.length > 0) {
            $(dropDownId).removeAttr("disabled");
            $.each(list, function () {
                $(dropDownId).append($("<option></option>").val(this['value']).html(this['text']));
            });
        }
        $(dropDownId).trigger("liszt:updated");
    }
</script>