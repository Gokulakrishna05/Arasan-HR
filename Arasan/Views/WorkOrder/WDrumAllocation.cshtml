@model Arasan.Models.WDrumallocation
@{
    ViewData["Title"] = "Drum allocation";
}
<style>
    .newwidth {
        width: 120px;
    }
    .mandatory{
	color: red;
	position:relative;
	top:2px;
	left:5px;
}
a{
        outline: none;
        text-decoration: none;
        color: #000;
    } 
    a:hover, a:active, a:focus {
        outline: none;
        text-decoration: none;
        color: #000;
    } 
    .container {
        max-width: 960px;
    }

    .panel-default > .panel-heading {
        color: #333;
        background-color: #fff;
        border-color: #e4e5e7;
        padding: 0;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .panel-default > .panel-heading a {
        display: block;
        padding: 10px 15px;
    }

    .panel-default > .panel-heading a:after {
        content: "";
        position: relative;
        top: 1px;
        display: inline-block;
    /*    font-family: 'Glyphicons Halflings';*/
        font-style: normal;
        font-weight: 400;
        line-height: 1;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        float: right;
        transition: transform .25s linear;
        -webkit-transition: -webkit-transform .25s linear;
    }

    .panel-default > .panel-heading a[aria-expanded="true"] {
        background-color: green;
    }

    .panel-default > .panel-heading a[aria-expanded="true"]:after {
        content: "\2212";
        -webkit-transform: rotate(180deg);
        transform: rotate(180deg);
    }

    .panel-default > .panel-heading a[aria-expanded="false"]:after {
        content: "\002b";
        -webkit-transform: rotate(90deg);
        transform: rotate(90deg);
    }

    .accordion-option {
        width: 100%;
        float: left;
        clear: both;
        margin: 15px 0;
    }

    .accordion-option .title {
        font-size: 20px;
        font-weight: bold;
        float: left;
        padding: 0;
        margin: 0;
    }

    .accordion-option .toggle-accordion {
        float: right;
        font-size: 16px;
        color: #49B6D6;
    }

    .accordion-option .toggle-accordion:before {
        content: "Expand All";
    }

    .accordion-option .toggle-accordion.active:before {
        content: "Collapse All";
    }

    .panel-title a {
        background-color: #49B6D6;
    }

    .panel-body table tr td {
        padding:5px;
    }

    .panel-body table {
       /* font-size: 15px;*/
        font-weight:normal;
    }
</style>
<div class="row wrapper border-bottom page-heading">
    <div class="col-lg-12">

        <ol class="breadcrumb">
            <li> <a href="#">Home</a> </li>
            <li> <a>Sales</a> </li>
            <li class="active"> <strong>Drum Allocation</strong> </li>
        </ol>
    </div>
</div>
<div class="wrapper-content ">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="widgets-container">
                    <h5 style="font-size:14px">Drum Allocation</h5>
                    <hr>
                                                              @using (Html.BeginForm("WDrumAllocation", "WorkOrder", FormMethod.Post))
                        {
                            @Html.AntiForgeryToken()
                            <form>
                             <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Branch <label class="mandatory"></label></label>
                                    <div class="col-sm-8">
                                     
                                            @Html.DisplayFor(C => C.Branch)<br>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Location<label class="mandatory"></label></label>
                                    <div class="col-sm-8">

                                            @Html.DisplayFor(C => C.Location)<br>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="height:10px;"></div>
                          <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Job Id <label class="mandatory"></label></label>
                                    <div class="col-sm-8">
                                     
                                            @Html.DisplayFor(C => C.JobId)<br>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Job date<label class="mandatory"></label></label>
                                    <div class="col-sm-8">

                                            @Html.DisplayFor(C => C.JobDate)<br>

                                    </div>
                                </div>
                            </div>
                        </div>
                                                <div style="height:10px;"></div>

                         <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Customer Name<label class="mandatory"></label></label>
                                    <div class="col-sm-8">
                                     
                                            @Html.DisplayFor(C => C.Customername)<br>
                                    </div>
                                </div>
                            </div>
                          @*  <div class="col-md-6">
                                <div class="form-group">

                                    <label for="inputName3" class="col-sm-4 control-label">Job date<label class="mandatory"></label></label>
                                    <div class="col-sm-8">

                                            @Html.DisplayFor(C => C.JobDate)<br>

                                    </div>
                                </div>
                            </div>*@
                        </div>
                        <div style="height:10px;"></div>
                          <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="inputName3" class="col-sm-4 control-label">Doc Id <label class="mandatory"></label></label>
                                    <div class="col-sm-8">
                                             @Html.TextBoxFor(C => C.DOCId, new { @id = "txtDocId", @class = "form-control", @TabIndex = 1,@readonly="readonly" })<br />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="inputName3" class="col-sm-4 control-label">Doc Date<label class="mandatory">*</label></label>
                                    <div class="input-group date form_date col-sm-8" data-date="" data-date-format="dd-M-yyyy">
                                        @Html.TextBoxFor(C => C.DocDate, new { @id = "DocDate", @class = "form-control", @TabIndex = 2,@size="32",@readonly=true })
                                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span> <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                                    </div>
                                    <br />
                                </div>
                            </div>
                        </div>


                         <div id="divshiftrowdetail">

                            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

                                 @{

                                                                    int i = 0;
                                                                    foreach (var item in Model.Worklst.ToList())
                                                                    {


                                                                                                                                                                                                                     <div class="panel panel-default">
                                                                                                                                                                                                <div class="panel-heading" role="tab" id="headingOne@(i)">
                                                                                                                                                                                                    <h4 class="panel-title">
                                                                                                                                                                                                        <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne@(i)" aria-expanded="false" aria-controls="collapseOne@(i)" class="collapsed">
                                                                                                                                                                                                           @Html.DisplayFor(o => o.Worklst[i].items)
                                                                                                                                                                                                        </a>
                                                                                                                                                                                                    </h4>
                                                                                                                                                                                                </div>

                                                                                                                                                                                                <div id="collapseOne@(i)" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne@(i)">
                                                                                                                                                                                                     <div class="panel-body">
                                                                                                                                                                                           
                                                                                                                                                                                            <div class="row">
                                                                                                                                                                                          <div class="col-md-6">
                                                                                                                                                                                <div class="form-group">

                                                                                                                                                                                    <label for="inputName3" class="col-sm-4 control-label">Search DRUM No.<label class="mandatory"> </label></label>
                                                                                                                                                                                    <div class="col-sm-4">
                                                                                                                                                                                        @Html.TextBoxFor(o => o.Worklst[i].search, new { @id = "txtSearch" + i, @class = "form-control", @TabIndex = 1 })
                                                                                                                                                                                        
                                                                                                                                                                                        <br />
                                                                                                                                                                                    </div>
                                                                                                                                                                                    <div class="col-sm-4">
                                                                                                                                                                                    <input id="button" type="button@(i)" value="Select" class="btn btn-success" onclick="selectdrum(@(i))" />
                                                                                                                                                                                    </div>
                                                                                                                                                                                </div>
                                                                                                                                                                            </div>   
                                                                                                                                                                             <div class="col-md-6">
                                                                                                                                                                              Total No.Of Drums Selected : <label id="lbldrumdisp"></label>
                                                                                                                                                                             </div>
                                                                                                                                                                                             </div>



                                                                                                                                                                                              <div class="row">
                                                                                                                                                                                   <div class="col-md-12" style="overflow-x:scroll; min-width:300px; min-height:300px;">
                                                                                                                                                         <table class="table table-striped table-hover" id="dataTable@(i)">
                                                                                                                                                                                                <thead>
                                                                                                                                                                                                    <tr>
                                                                                                                                                                                                        <th> @Html.CheckBoxFor(o => o.Worklst[i].selectall, new { @id = "Selectallchk" + i , @onclick = "enableAllrepview("+ i +");" })</th>
                                                                                                                                                                                                        <th>BATCH NO</th>
                                                                                                                                                                                                        <th>DRUM NO</th>
                                                                                                                                                                                                        <th>QTY</th>
                                                                                                                                                                                                        <th>RATE </th>
                                                                                                                                                                                                    </tr>
                                                                                                                                                                                                </thead>
                                                                                                                                                                                                <tbody id="tbBooks@(i)">
                                                                                                                                                                                        @{

                                                int j = 0;

                                                foreach (var drum in item.drumlst.ToList())
                                                {
                                                                                                                                                                                                             <tr id="trBook_@(i)_@(j)" class="chkitemlst@(i)" style="height: 30px;border-bottom: 1px dashed #ddd;">
                                                                                                                                                                                                               <td>@Html.CheckBoxFor(o => drum.drumselect, new { @id = "drumslect_" + i + "_" + j })@Html.HiddenFor(o => drum.invid, new { @id = "invid_" + i + "_" + j }) </td>
                                                                                                                                                                                                                <td>@Html.DisplayFor(o => drum.lotno)</td>
                                                                                                                                                                                                               <td>@Html.DisplayFor(o => drum.drumno)@Html.HiddenFor(o => drum.drumno, new { @id = "drumno_" + i + "_" + j })</td>
                                                                                                                                                                                                               <td>@Html.DisplayFor(o => drum.qty)@Html.HiddenFor(o => drum.qty, new { @id = "qty_" + i + "_" + j })</td>
                                                                                                                                                                                                             <td>@Html.DisplayFor(o => drum.rate)</td>
                                                                                                                                                                                                  </tr>                                                                                                                                                                                                   

                                                                         j = j + 1;
                                                }
                                                                                                                                                                                             }
                                                                                                                                                                                             </tbody>
                                                                                                                                                                                                </table>
                                                                                                                                                                                       </div>
                                                                                                                                                                                   </div>






                                                                                                                                                                                        </div>
                                                                                                                                                                                     </div>            
                                                                                                                                                                                 </div>
                                                                        i = i + 1;
                                                                    }
                                                                }

</div>

 </div>
                          <div style="height:30px;"></div>
                                <button type="submit" class="btn aqua m-t-xs bottom15-xs" id="btnSave">Submit</button>
                                <button class="btn btn-danger" type="button" causesvalidation="false" onclick="location.href='@Url.Action("ListWDrumAllocation", "WorkOrder")'">Cancel</button>


                        </form>
  }
                </div>
            </div>
        </div>

    </div>
</div>
<script>
    $(function () {
        $('._select').select2();
    });
    $('.form_date').datetimepicker({
        //   language:  'fr',
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0
    });
    function enableAllrepview(i) {
        
        if ($("#Selectallchk" + i).prop('checked') == true) {
            var j = 0;
            $('tr.chkitemlst'+ i).each(function() {
                if ($(this).css('display') !== 'none') {

                    $('#drumslect_' + i + '_' + j ).prop('checked', true);

                }
                j += 1;
            });

        }
        else {
            var j = 0;
            $('tr.chkitemlst'+ i).each(function() {
                if ($(this).css('display') !== 'none') {

                    $('#drumslect_' + i + '_' + j).prop('checked', false);

                }
                j += 1;
            });
        }
    }
     function selectdrum(i) {
         var j = 0;
             $('tr.chkitemlst'+ i).each(function() {
                if ($(this).css('display') !== 'none') {
                             $('#drumslect_' + i + '_' + j).prop('checked', false);
                }
                j += 1;
            });

         
         var drumtext = document.getElementById("txtSearch" + i).value;
         const myArray = drumtext.split(",");
         var drumnos = "";
         for (let i = 0; i < myArray.length; i++) {
             var splittext = myArray[i].split("-");
             if (splittext.length > 1) {
                 var fir = splittext[0].length;
                 var cunt = splittext[1].length;
                 var rcunt = eval(fir) - eval(cunt);
                 var string = splittext[0].substring(0, rcunt);
                 var fstring = splittext[0].substring(splittext[0].length - cunt, splittext[0].length);
                 var lstring = splittext[1];
                 for (let j = eval(fstring); j < eval(lstring) +1 ; j++) {
                     var n=zeroPad(j,cunt)
                     var drumno = string + n;
                     drumnos += drumno + ",";
                    
                 }

             } else {
                  drumnos += myArray[i] + ",";
                  //tot += 1;
             }

}
drumnos = drumnos.substr(0,drumnos.length-1);
var tot = 0;

  if (drumnos != "") {
             var j = 0;
             const myArray = drumnos.split(",");
            $('tr.chkitemlst'+ i).each(function() {
                if ($(this).css('display') !== 'none') {
                var invid=document.getElementById('drumno_' + i + '_' + j).value;
                    for (let k = 0; k < myArray.length; k++) {
                        if (invid == myArray[k]) {
                             $('#drumslect_' + i + '_' + j).prop('checked', true);
                              tot += 1;
                            break;
                        }
                    }

                }
                j += 1;
            });
      }
         document.getElementById("lbldrumdisp").innerHTML = tot;
}

function zeroPad(num, places) {
  var zero = places - num.toString().length + 1;
  return Array(+(zero > 0 && zero)).join("0") + num;
}
</script>
